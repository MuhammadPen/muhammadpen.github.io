---
interface Props {
  title: string;
  link: string;
  slides: { image?: string; description?: string }[];
  color: string;
}

const { title, link, slides, color } = Astro.props;
---

<div class="flex flex-col text-right gap-2">
  <div>
    <a
      href={link}
      target="_blank"
      class="external-link hover:underline text-2xl md:text-3xl">{title}</a
    >
  </div>

  <div class="border-t" style={`background-color: ${color}20`}>
    <div class="project-showcase-container flex md:flex-row flex-col">
      {
        slides.map((slide, index) => {
          return (
            <div class="showcase-slide flex md:flex-row flex-col-reverse md:mr-16 mb-16 gap-x-96 gap-y-10 border-b">
              {slide.image && (
                <div class="md:border-r p-5">
                  <img
                    class="md:min-w-[768px] md:min-h-[425px] rounded-sm"
                    src={slide.image}
                    alt={slide.description}
                  />
                </div>
              )}
              {slide.description && (
                <div class="relative md:min-w-[568px] md:min-h-[425px] text-2xl text-right leading-10 md:leading-12 whitespace-pre-line">
                  {slide.description}

                  {slides.length > 1 && index < slides.length - 2 && (
                    <button
                      class="next-slide-btn hidden md:flex text-4xl absolute bottom-10 right-0 animate-wiggle hover:cursor-pointer"
                      data-slide-index={index}
                    >
                      →
                    </button>
                  )}
                </div>
              )}
            </div>
          );
        })
      }
    </div>
  </div>
</div>

<style>
  .external-link::after {
    content: " ↗";
    font-size: 0.75em;
    margin-right: 0.25em;
  }

  .project-showcase-container {
    overflow-x: scroll;
    overflow-y: hidden;
    scroll-behavior: smooth;
  }
</style>

<script>
  // Event delegation - single listener for all buttons
  document.addEventListener("click", (e) => {
    const button = (e.target as Element).closest(".next-slide-btn");
    if (!button) return;

    const currentSlide = button.closest(".showcase-slide");
    const nextSlide = currentSlide?.nextElementSibling;

    // Use scrollIntoView for reliable, native scrolling
    nextSlide?.scrollIntoView({
      behavior: "smooth",
      block: "nearest",
      inline: "start",
    });
  });
</script>
